fragment dxIntlPlayersFields on dx_intl_players {
  id
  nickname
  private
  created_at
  updated_at
  dx_intl_record {
    card_name
    rating
    grade
    course_rank
    class_rank
  }
}


query dxIntlPlayersForUser($userId: String!) {
  dx_intl_players(where: { user_id: { _eq: $userId } }) {
    ...dxIntlPlayersFields
  }
}

query dxIntlPlayersWithKeywordAnonymous($nickname_like: String!) {
  other_players: dx_intl_players(
    where: { nickname: { _ilike: $nickname_like }, dx_intl_record: {} }
    order_by: { nickname: asc }
    limit: 10
  ) {
    ...dxIntlPlayersFields
  }
}

query dxIntlPlayersWithKeywordUser($userId: String!, $nickname_like: String!) {
  user_players: dx_intl_players(
    where: {
      user_id: { _eq: $userId }
      nickname: { _ilike: $nickname_like }
      dx_intl_record: {}
    }
    order_by: { nickname: asc }
  ) {
    ...dxIntlPlayersFields
  }
  other_players: dx_intl_players(
    where: {
      user_id: { _neq: $userId }
      nickname: { _ilike: $nickname_like }
      dx_intl_record: {}
    }
    order_by: { nickname: asc }
    limit: 10
  ) {
    ...dxIntlPlayersFields
  }
}

fragment dxIntlSongsFields on dx_intl_songs {
  id
  category
  title
  order
  dx_intl_variants(order_by: { deluxe: asc }) {
    deluxe
    version
    active
    dx_intl_notes(order_by: { difficulty: asc }) {
      internal_lv
      difficulty
      level
    }
  }
}

query dxIntlSongs {
  dx_intl_songs(order_by: [{ category: asc }, { order: asc }]) {
    ...dxIntlSongsFields
  }
}

query dxIntlSongsById($idLike: String!) {
  dx_intl_songs(
    order_by: [{ category: asc }, { order: asc }]
    where: { id: { _like: $idLike } }
  ) {
    ...dxIntlSongsFields
  }
}

query dxIntlRecordWithScores($nickname: String!) {
  dx_intl_players(where: { nickname: { _eq: $nickname } }) {
    updated_at
    private
    dx_intl_record {
      card_name
      title
      trophy
      rating
      max_rating
      rating_legacy
      grade
      course_rank
      class_rank
    }
    dx_intl_scores {
      song_id
      deluxe
      difficulty
      score
      combo_flag
      sync_flag
      start
    }
  }
}

query dxIntlPlayersTimelines($nickname: String!) {
  dx_intl_players_timelines(where: { nickname: { _eq: $nickname } }) {
    timelines
  }
}

query dxIntlPlayerWithTimeline($nickname: String!, $time: timestamptz!) {
  beforeRecord: dx_intl_records_with_history(
    where: {
      dx_intl_player: { nickname: { _eq: $nickname } }
      end: { _eq: $time }
    }
  ) {
    card_name
    title
    trophy
    rating
    max_rating
    grade
    course_rank
    class_rank
  }
  afterRecord: dx_intl_records_with_history(
    where: {
      dx_intl_player: { nickname: { _eq: $nickname } }
      start: { _eq: $time }
    }
  ) {
    card_name
    title
    trophy
    rating
    max_rating
    grade
    course_rank
    class_rank
  }
  beforeScores: dx_intl_scores_with_history(
    where: {
      dx_intl_player: { nickname: { _eq: $nickname } }
      end: { _eq: $time }
    }
  ) {
    song_id
    deluxe
    difficulty
    score
    combo_flag
    sync_flag
  }
  afterScores: dx_intl_scores_with_history(
    where: {
      dx_intl_player: { nickname: { _eq: $nickname } }
      start: { _eq: $time }
    }
  ) {
    song_id
    deluxe
    difficulty
    score
    combo_flag
    sync_flag
  }
}